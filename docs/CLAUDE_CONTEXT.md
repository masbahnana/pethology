# ü§ñ Claude Context - Pethology Development

**√öltima atualiza√ß√£o:** 17 Outubro 2025
**Sess√µes:** 2-3 sess√µes de desenvolvimento

---

## üìù **RESUMO DO PROJETO:**

**Pethology** √© uma plataforma educacional (LMS) especializada em **Animal Care & Veterinary Studies** para estudantes de PLC (Post Leaving Certificate) na Irlanda.

**Objetivo:** Competir com Moodle e Microsoft Teams, oferecendo:
- Sistema de quiz inteligente (adaptive AI)
- Gamifica√ß√£o (achievements, streaks, XP)
- UI moderna e intuitiva
- Foco em nicho espec√≠fico (Animal Care)

---

## üéØ **SESS√ÉO ATUAL (17 OUT 2025):**

### **‚úÖ O que foi implementado:**

1. **Achievement System (19 conquistas)**
   - Arquivo: `assets/js/achievements.js` (538 linhas)
   - 4 categorias: Learning, Consistency, Specialized, Special
   - Toast notifications com som
   - Locked/unlocked states visuais
   - Integra√ß√£o com Firebase
   - Automatic checking ap√≥s quiz completion

2. **User Indicator no Header**
   - C√≠rculo com iniciais do usu√°rio
   - Dropdown com Dashboard link e Logout
   - Aparece automaticamente quando logado
   - Firebase methods: `getCurrentUser()`, `logout()`

3. **Progress Circles Din√¢micos**
   - Mostram 4 m√≥dulos mais recentes
   - Ordena√ß√£o por data real de quiz completion
   - Cores para todos os 11 m√≥dulos
   - Auto-cria√ß√£o de module progress

4. **Import Students Page**
   - Arquivo: `import-students.html` (nova p√°gina)
   - CSV upload com drag & drop
   - Manual entry form (firstName, lastName, email)
   - Valida√ß√£o @plc.ie
   - Preview antes de salvar
   - Firebase methods: `addPreRegisteredStudent()`, `checkPreRegistered()`, `markAsRegistered()`, `getPreRegisteredStudents()`

5. **UI Improvements**
   - Centralized quiz answer buttons
   - Module name normalization fix
   - Back to Menu navigation fix
   - All 11 module colors defined

6. **Documentation**
   - `MOODLE_TEAMS_COMPARISON.md` - An√°lise completa de features necess√°rias
   - `TODO.md` atualizado com novas prioridades
   - Class Management System especificado
   - Announcements & Calendar planejados

---

## üî• **PR√ìXIMAS PRIORIDADES (em ordem):**

### **1. WHITELIST SIGNUP SYSTEM (2-3h) - PR√ìXIMO PASSO**
**Status:** Parcialmente implementado (import pronto)

**O que falta:**
- Modificar `auth0-callback.html` - adicionar whitelist check
- Bloquear signup se email n√£o est√° na whitelist
- Mostrar mensagem: "You need an invitation from your teacher"
- Auto-assign aluno √† turma ap√≥s signup aprovado
- Testar fluxo completo

**Arquivos cr√≠ticos:**
- `auth0-callback.html` - Adicionar l√≥gica de verifica√ß√£o

---

### **2. ANNOUNCEMENTS SYSTEM (3-4h)**
**Teacher:**
- Bot√£o "üì¢ New Announcement"
- Form: title, message, pin to top, send email
- Lista com edit/delete

**Student:**
- Banner no topo do dashboard
- Badge com n√∫mero de n√£o lidos
- Mark as read

**Firebase:**
```javascript
/announcements/{id}
{
  classId, createdBy, title, message,
  isPinned, createdAt, readBy: []
}
```

---

### **3. CALENDAR + ASSIGNMENT REMINDERS (3-4h)**
- Calendar widget visual
- Lista "Upcoming Deadlines" (7 dias)
- Color coding (quiz, assignment, exam, announcement)
- Overdue warnings
- Click ‚Üí vai para item

**Firebase:**
```javascript
/events/{id}
{
  classId, type, title, date, dueDate, relatedId
}
```

---

## üìä **ESTADO ATUAL DO C√ìDIGO:**

### **Arquivos Principais:**

**Frontend:**
- `student-dashboard.html` - Dashboard com achievements, progress circles
- `teacher-dashboard.html` - Teacher analytics + Import Students button
- `import-students.html` - CSV/manual student import (NOVO)
- `quiz.html` - Quiz system com user indicator

**JavaScript:**
- `assets/js/achievements.js` - Achievement system completo (NOVO)
- `assets/js/firebase-service.js` - Firebase methods + class management
- `assets/js/quiz/quiz.js` - Quiz logic + normalization fixes

**Documentation:**
- `TODO.md` - Roadmap completo
- `MOODLE_TEAMS_COMPARISON.md` - Feature analysis (NOVO)
- `ACHIEVEMENTS_README.md` - Achievement system docs
- `CLAUDE_CONTEXT.md` - Este arquivo (NOVO)

---

## üóÇÔ∏è **FIREBASE COLLECTIONS:**

### **Existentes:**
```
/users/{userId}
  - id, name, email, role, photo, lastLogin

/student_progress/{userId}
  - overallStats, moduleProgress, achievements

/quiz_results/{resultId}
  - userId, quizId, score, answers, completedAt
```

### **Novas (implementadas):**
```
/pre_registered_students/{email}
  - email, firstName, lastName, classId, addedBy, registered
```

### **Planejadas:**
```
/classes/{classId}
  - name, code, teachers[], students{registered[], pending[]}

/announcements/{id}
  - classId, title, message, isPinned, readBy[]

/events/{id}
  - classId, type, title, date, dueDate

/quizzes/{quizId}  (custom quizzes)
  - isPublic, classId, createdBy, questions[]
```

---

## üîê **SECURITY RULES (para implementar):**

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Pre-registered students (whitelist)
    match /pre_registered_students/{email} {
      allow read: if request.auth != null;
      allow create, update, delete: if isTeacher();
    }

    // Quizzes - PUBLIC vs CUSTOM
    match /quizzes/{quizId} {
      allow read: if resource.data.isPublic == true
                  || (request.auth != null
                      && isStudentInClass(resource.data.classId));
      allow create, update, delete: if isTeacher();
    }

    // Classes
    match /classes/{classId} {
      allow read: if request.auth != null
                  && (isTeacher() || isStudentInClass(classId));
      allow create, update, delete: if isTeacher();
    }
  }
}
```

---

## üí° **DECIS√ïES DE DESIGN:**

### **1. Sistema Fechado (Whitelist)**
**Decis√£o:** Apenas emails pr√©-registrados pelo professor podem criar conta.

**Raz√£o:**
- Controle total do professor
- Zero spam/cadastros aleat√≥rios
- Seguran√ßa para custom quizzes
- Rastreabilidade completa

**Como funciona:**
1. Professor adiciona emails na whitelist (CSV ou manual)
2. Aluno tenta fazer signup
3. Sistema verifica se email est√° na whitelist
4. Se SIM ‚Üí permite signup + auto-assign √† turma
5. Se N√ÉO ‚Üí bloqueia com mensagem "You need an invitation"

---

### **2. Public vs Custom Quizzes**
**Decis√£o:** Dois tipos de quiz no sistema.

**Public Quizzes:**
- 10 m√≥dulos fixos (Biology, Animal Welfare, etc.)
- Vis√≠vel para TODOS (logado ou n√£o)
- Visitantes podem fazer 30% das quest√µes

**Custom Quizzes:**
- Criados/importados pelo professor
- Vis√≠vel APENAS para alunos da turma
- N√£o aparecem para visitantes
- Professor pode importar de Microsoft Forms

**Raz√£o:**
- Public modules = marketing/demo do sistema
- Custom quizzes = conte√∫do exclusivo/sens√≠vel da turma
- Flexibilidade para professor

---

### **3. Announcements vs Real-time Chat**
**Decis√£o:** Announcements ass√≠ncronos, SEM chat em tempo real.

**Raz√£o:**
- Chat tem muita complexidade (WebSocket, message history, typing indicators)
- Alunos j√° usam WhatsApp/Discord para chat
- Announcements resolvem 80% das necessidades de comunica√ß√£o
- Professor precisa enviar avisos, n√£o conversar 24/7

---

### **4. Calendar sem Assignment System (por enquanto)**
**Decis√£o:** Implementar calendar com deadlines, mas sem assignment upload full-featured.

**Raz√£o:**
- Assignment system completo = 6-8 horas
- Calendar = 3-4 horas
- Calendar sozinho j√° √© muito √∫til (visibilidade de deadlines)
- Assignments podem vir depois

---

## üêõ **BUGS CONHECIDOS:**

1. ‚úÖ **RESOLVIDO:** Quiz answer buttons n√£o centralizados ‚Üí Adicionado CSS `display: block !important`
2. ‚úÖ **RESOLVIDO:** Module names inconsistentes ‚Üí Aplicado `normalizeModuleName()` no save
3. ‚úÖ **RESOLVIDO:** Module progress n√£o auto-criado ‚Üí Adicionado check e cria√ß√£o autom√°tica
4. ‚úÖ **RESOLVIDO:** Back to Menu quebrado ‚Üí Revertido para comportamento simples
5. ‚úÖ **RESOLVIDO:** Firebase composite index missing ‚Üí Implementado fallback query com sort manual

**Pendentes:**
- Nenhum conhecido no momento

---

## üìà **M√âTRICAS DE PROGRESSO:**

### **Commits Recentes:**
- **Commit 923f5b2** (17 Out 2025): Achievement system + user indicator + class management spec
  - +2,325 linhas adicionadas
  - 7 arquivos modificados
  - 2 arquivos novos criados

### **Total de Features:**
- ‚úÖ 19 Achievements implementados
- ‚úÖ 200 quest√µes de quiz (10 m√≥dulos)
- ‚úÖ Firebase + Auth0 setup
- ‚úÖ Student & Teacher dashboards
- ‚úÖ Import students (CSV + manual)
- ‚úÖ User indicator com dropdown
- ‚úÖ Progress tracking din√¢mico

---

## üîç **CONTEXTO PARA PR√ìXIMA SESS√ÉO:**

### **Onde paramos:**
- Acabamos de fazer commit de achievement system + import students
- TODO.md atualizado com Announcements e Calendar planejados
- Pr√≥ximo passo: **WHITELIST SIGNUP** (modificar auth0-callback.html)

### **O que voc√™ precisa saber:**
1. **Whitelist √© CR√çTICO** - sem isso, qualquer pessoa pode criar conta
2. **auth0-callback.html** √© o arquivo que processa signup/login do Auth0
3. Precisamos adicionar check de `checkPreRegistered(email)` antes de criar conta
4. Se email n√£o est√° na whitelist, mostrar erro e fazer logout

### **Quick Start para pr√≥xima sess√£o:**
```
Ol√° Claude! Vamos continuar o Pethology.

Status atual:
‚úÖ Achievement system implementado
‚úÖ Import students page pronta
‚úÖ Firebase methods de whitelist prontos

Pr√≥ximo objetivo: WHITELIST SIGNUP BLOCKING

Preciso:
1. Modificar auth0-callback.html
2. Adicionar check de email na whitelist
3. Bloquear signup se n√£o estiver pr√©-registrado
4. Mostrar mensagem de erro clara
5. Auto-assign √† turma se aprovado

Arquivo cr√≠tico: auth0-callback.html

Pode me ajudar a implementar?
```

---

## üé® **TECH STACK:**

**Frontend:**
- Vanilla HTML/CSS/JS (ES6 Modules)
- No frameworks (deliberado para simplicidade)
- Firebase SDK 10.7.1
- Auth0 for authentication

**Backend:**
- Firebase Firestore (database)
- Firebase Authentication (via Auth0)
- Netlify (hosting)
- GitHub (version control)

**Tools:**
- Fisher-Yates Shuffle (quiz randomization)
- Web Audio API (achievement sounds)
- Drag & Drop API (CSV upload)

---

## üåê **DEPLOYMENT:**

**Production:**
- URL: https://pethology.netlify.app
- Auto-deploy from GitHub main branch
- Environment: Production

**Firebase:**
- Project ID: pethology-7e9d7
- Region: europe-west1
- Rules: Currently open (needs tightening)

**Auth0:**
- Domain: pethology.eu.auth0.com
- Connections: Microsoft, Google, Email/Password
- Callbacks configured for Netlify

---

## üìö **DOCUMENTA√á√ÉO ADICIONAL:**

- Ver `MOODLE_TEAMS_COMPARISON.md` para an√°lise de features
- Ver `ACHIEVEMENTS_README.md` para detalhes do sistema de conquistas
- Ver `TODO.md` para roadmap completo
- Ver `TODO.md` se√ß√£o "Class Management System" para spec completa do sistema de turmas

---

## üí¨ **NOTAS DA CONVERSA:**

### **User Preferences:**
- Prefere fazer commit frequentemente antes de grandes mudan√ßas
- Gosta de organiza√ß√£o clara (TODO.md, CLAUDE_CONTEXT.md)
- Foco em features pr√°ticas (n√£o precisa de tudo que Moodle tem)
- Prioriza: Announcements + Calendar (n√£o precisa chat em tempo real)

### **Design Philosophy:**
- Simples > Complexo
- Visual > Texto
- Gamifica√ß√£o para engajamento
- Especializa√ß√£o no nicho (Animal Care)

---

**Fim do contexto. Pr√≥xima sess√£o: WHITELIST SIGNUP BLOCKING! üöÄ**
